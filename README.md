# Complete OBI-tools Workflow Example

This example shows how to use the optimized pipeline with library blanks and isolation blanks.

## 1. Edit the configuration file
Edit `config/config.yaml`, define location of your reads, barcodes, and name of the project.

## 2. Prepare Your Barcode Files
OBItools does not work with barcodes of different lengths, thus in the first part of the pipeline, the barcode file is divided by barcode lengths and the raw files are demultilexed separately for barcodes of different lengths, then results are concatenated.

Example barcode file (note that it does not contain @headers, these are defined in the confg file):
```csv
experiment,sample,sample_tag,forward_primer,reverse_primer
ZSG3,LB_1,AACAAGCC,GGGCAATCCTGAGCCAA,CCATTGAGTCTCTGCACCTATC
ZSG3,LB_2,TGAGAGCT,GGGCAATCCTGAGCCAA,CCATTGAGTCTCTGCACCTATC
ZSG3,LB_3,ACAACCGA,GGGCAATCCTGAGCCAA,CCATTGAGTCTCTGCACCTATC
ZSG3,LB_4,TTACGCCA,GGGCAATCCTGAGCCAA,CCATTGAGTCTCTGCACCTATC
ZSG3,PB_1,GGATAGCA,GGGCAATCCTGAGCCAA,CCATTGAGTCTCTGCACCTATC
ZSG3,PB_2,ACACACAG,GGGCAATCCTGAGCCAA,CCATTGAGTCTCTGCACCTATC
ZSG3,PB_3,TCCAACAC,GGGCAATCCTGAGCCAA,CCATTGAGTCTCTGCACCTATC
ZSG3,PB_4,CAACCTCA,GGGCAATCCTGAGCCAA,CCATTGAGTCTCTGCACCTATC
ZSG3,ZSG3_SB_D1_isol1_1,GTGTAGTC,GGGCAATCCTGAGCCAA,CCATTGAGTCTCTGCACCTATC
ZSG3,ZSG3_SB_D1_isol1_2,TATCTGGC,GGGCAATCCTGAGCCAA,CCATTGAGTCTCTGCACCTATC
ZSG3,ZSG3_SB_D1_isol1_3,GTGTGTGT,GGGCAATCCTGAGCCAA,CCATTGAGTCTCTGCACCTATC
ZSG3,ZSG3_SB_D1_isol1_4,CTGTCAAC,GGGCAATCCTGAGCCAA,CCATTGAGTCTCTGCACCTATC
ZSG3,IB_isol1_1,TGAGTTCCT,GGGCAATCCTGAGCCAA,CCATTGAGTCTCTGCACCTATC
ZSG3,IB_isol1_2,TCTGGTTGA,GGGCAATCCTGAGCCAA,CCATTGAGTCTCTGCACCTATC
ZSG3,IB_isol1_3,TCACGGATA,GGGCAATCCTGAGCCAA,CCATTGAGTCTCTGCACCTATC
ZSG3,IB_isol1_4,TTCCACCTA,GGGCAATCCTGAGCCAA,CCATTGAGTCTCTGCACCTATC
ZSG3,ZSG3_025_D1_isol1_1,AGGAATGAG,GGGCAATCCTGAGCCAA,CCATTGAGTCTCTGCACCTATC
ZSG3,ZSG3_025_D1_isol1_2,ACTGACCTT,GGGCAATCCTGAGCCAA,CCATTGAGTCTCTGCACCTATC
ZSG3,ZSG3_025_D1_isol1_3,ATGAGCCTA,GGGCAATCCTGAGCCAA,CCATTGAGTCTCTGCACCTATC
ZSG3,ZSG3_025_D1_isol1_4,ATCATAGCG,GGGCAATCCTGAGCCAA,CCATTGAGTCTCTGCACCTATC
ZSG3,ZSG3_041_D1_isol1_1,AATTGCCG,GGGCAATCCTGAGCCAA,CCATTGAGTCTCTGCACCTATC
ZSG3,ZSG3_041_D1_isol1_2,ATGCTTGG,GGGCAATCCTGAGCCAA,CCATTGAGTCTCTGCACCTATC
ZSG3,ZSG3_041_D1_isol1_3,ATGGAGGT,GGGCAATCCTGAGCCAA,CCATTGAGTCTCTGCACCTATC
ZSG3,ZSG3_041_D1_isol1_4,TGAGGACA,GGGCAATCCTGAGCCAA,CCATTGAGTCTCTGCACCTATC
ZSG3,ZSG3_057_D1_isol1_1,CCGACCATA,GGGCAATCCTGAGCCAA,CCATTGAGTCTCTGCACCTATC
ZSG3,ZSG3_057_D1_isol1_2,CAACACCGT,GGGCAATCCTGAGCCAA,CCATTGAGTCTCTGCACCTATC
ZSG3,ZSG3_057_D1_isol1_3,CTCATACGC,GGGCAATCCTGAGCCAA,CCATTGAGTCTCTGCACCTATC
ZSG3,ZSG3_057_D1_isol1_4,CAACAGGAG,GGGCAATCCTGAGCCAA,CCATTGAGTCTCTGCACCTATC
```

## 3. Run the Pipeline

```bash
# First, do a dry run
snakemake -n

# Run with 4 cores
snakemake --cores 4

# The pipeline will:
# 1. Automatically detect barcode lengths (8bp, 9bp, etc.)
# 2. Split barcode files by length
# 3. Process each library separately
# 4. Merge all libraries
# 5. Dereplicate, filer by read counts, denoise
# 6. Perform taxonomic classification
```
